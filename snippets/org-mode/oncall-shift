# -*- mode: snippet -*-
# name: oncall-shift
# key: <shift
# expand-env: ((daily-oncall-checklist-scheduled-time (format-time-string (car org-time-stamp-formats) (current-time))))
# --
*** `daily-oncall-checklist-scheduled-time`
$0**** TODO [0/5] DAILY TRIAGE (check [[https://confluence.internal.salesforce.com/display/EN/PE+Daily+Triage+Process+-+on-call][PE Daily Triage Process - on-call]] for updates)
     SCHEDULED: `daily-oncall-checklist-scheduled-time`
***** TODO Review the [[https://confluence.internal.salesforce.com/display/EN/Service+Dashboards][Service Dashboards]]
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
****** Notes
****** Puppet Overview dashboard; look for failing/non-reporting nodes; know why any prod host is alerting on non-standard (production) Puppet environment, especially if >1 day
****** Look for anything that sticks out from the overall pattern: outliers, lines aproaching upper or lower limits (disk nearly full, etc)
****** Engage the relevant team members (PE or Eng), create or update relevant Work Items
***** TODO Review the [[https://eureka.sfdcsec.com/poc/vuln_plugin_details_table.php?str=cloud_name:MarketingCloud%20-%20DMP][Eureka Security & Compliance Dashboard]]
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
****** Look for anything with severity P0 (these will need rapid remediation)
****** Engage the relevant team members (PE), create or update relevant Work Items
***** TODO Review Available [[https://cb.krxd.net/cje][Cloudbees]] updates: If there are unapplied security updates, follow [[https://confluence.internal.salesforce.com/display/EN/Updating+Cloudbees][Updating Cloudbees]].
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
      If you see a red square with a number on the nav bar, click that to see whether an update is needed.
****** TODO Check the plugin-manager updates screens [[https://cb.krxd.net/cjoc/pluginManager/][cjoc]] and [[https://cb.krxd.net/cje/pluginManager/][cje]].
****** Of late there are 2 jobs that create files with ownership that Cloudbees cannot clean up on its own. If you want to quiet the "Asynchronous Resource Disposer", try:
       #+begin_src sh
       clush -w cloudbees-agent-a00[1-3]-ash-prod 'sudo chown -R c_cloudbees:c_cloudbees /data/c_cloudbees/cje/workspace/rb_dataconsole-pr-{unit-tests,migrations}*'
       #+end_src
***** TODO Review Available CD4PE Upgrades
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
******* Check the [[https://puppet-cicd-prod.krxd.net:8800/app/cd4pe/version-history][Continuous Delivery for Puppet Enterprise Version History]]
******* If there is a new version, review Release Notes and pre-flight checks.
******** If the upgrade looks easy, click Deploy button, watch, verify the new version number in the bottom-left corner of the console.
******** If the upgrade looks complicated, make a ticket for it to be done.
***** TODO Check for pending AWS maintenance
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
****** RDS
         #+begin_src sh :exports both :eval no-export :wrap src json :results raw
         aws rds describe-pending-maintenance-actions --region eu-west-1
         aws rds describe-pending-maintenance-actions --region us-east-1
         aws rds describe-pending-maintenance-actions --region us-west-2
         #+end_src
****** Elasticache
         #+begin_src sh :exports both :eval no-export :wrap src json :results raw
         aws elasticache describe-events --region eu-west-1
         aws elasticache describe-events --region us-east-1
         aws elasticache describe-events --region us-west-2
         aws elasticache describe-update-actions --query 'UpdateActions[].{severity: ServiceUpdateSeverity, update: ServiceUpdateName, cluster: ReplicationGroupId, due: ServiceUpdateRecommendedApplyByDate}'
         #+end_src
****** Redshift
         #+begin_src sh :exports both :eval no-export :wrap src json :results raw
         aws redshift describe-events --region eu-west-1
         aws redshift describe-events --region us-east-1
         aws redshift describe-events --region us-west-2
         #+end_src
***** TODO Review email notifications. Update or create Work Items, raise awareness if necessary.
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
****** cron errors
****** AWS reports
****** GitHub Security Alert Digests (gmail filter =from:notifications@github.com subject:"security vulnerability"=)
