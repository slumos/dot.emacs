# -*- mode: snippet -*-
# name: oncall-shift
# key: <shift
# expand-env: ((daily-oncall-checklist-scheduled-time (format-time-string (car org-time-stamp-formats) (current-time))))
# --
*** `daily-oncall-checklist-scheduled-time`
**** TODO [0/5] DAILY TRIAGE (check [[https://confluence.internal.salesforce.com/display/EN/PE+Daily+Triage+Process+-+on-call][PE Daily Triage Process - on-call]] for updates)
     SCHEDULED: `daily-oncall-checklist-scheduled-time`
***** TODO Check [[https://app.datadoghq.com/monitors/triggered?q=muted%3Afalse%20group_status%3A(alert%20OR%20warn)%20triggered%3A1440][DataDog Monitors]]
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
****** Fix any low-hanging fruit. See [[https://confluence.internal.salesforce.com/display/EN/Common+Triage+Issues][Common Triage Issues]] for examples.
****** For known issues, write a comment on the event linking to the appropriate Work Item. Raise awareness if necessary.
****** Make sure you know why any prod host is alerting on non-standard (production) Puppet environment, especially if >1 day
****** Clear out any stale entries in the [[https://app.datadoghq.com/monitors#downtime][downtime schedule]] that might cause a missed alert
***** TODO Visit the [[https://puppet-ui-prod.krxd.net/#/enforcement/status][Puppet Overview dashboard]]; look for failing/non-reporting nodes; know why any prod host is alerting on non-standard (production) Puppet environment, especially if >1 day
***** TODO Review the [[https://confluence.internal.salesforce.com/display/EN/Service+Dashboards][Service Dashboards]]
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
****** Notes
****** Look for anything that sticks out from the overall pattern: outliers, lines aproaching upper or lower limits (disk nearly full, etc)
****** Engage the relevant team members (PE or Eng), create or update relevant Work Items
***** TODO Review the [[https://eureka.sfdcsec.com/poc/vuln_plugin_details_table.php?str=cloud_name:MarketingCloud%20-%20DMP][Eureka Security & Compliance Dashboard]]
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
****** Look for anything with severity P0 (these will need rapid remediation)
****** Engage the relevant team members (PE), create or update relevant Work Items
***** TODO Review Available [[https://cb.krxd.net/cje][Cloudbees]] updates: If there are unapplied security updates, follow [[https://confluence.internal.salesforce.com/display/EN/Updating+Cloudbees][Updating Cloudbees]].
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
      If you see a red square with a number on the nav bar, click that to see whether an update is needed.
****** TODO Check the plugin-manager updates screens [[https://cb.krxd.net/cjoc/pluginManager/][cjoc]] and [[https://cb.krxd.net/cje/pluginManager/][cje]].
****** Of late there are 2 jobs that create files with ownership that Cloudbees cannot clean up on its own. If you want to quiet the "Asynchronous Resource Disposer", try:
       #+begin_src sh
       clush -w cloudbees-agent-a00[1-3]-ash-prod 'sudo chown -R c_cloudbees:c_cloudbees /data/c_cloudbees/cje/workspace/rb_dataconsole-pr-{unit-tests,migrations}*'
       #+end_src
***** TODO Check for pending AWS maintenance
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
****** RDS
         #+begin_src sh :exports both :eval no-export :wrap src json :results raw
         aws rds describe-pending-maintenance-actions --region eu-west-1
         aws rds describe-pending-maintenance-actions --region us-east-1
         aws rds describe-pending-maintenance-actions --region us-west-2
         #+end_src
****** Elasticache
         #+begin_src sh :exports both :eval no-export :wrap src json :results raw
         aws elasticache describe-events --region eu-west-1
         aws elasticache describe-events --region us-east-1
         aws elasticache describe-events --region us-west-2
         #+end_src
****** Redshift
         #+begin_src sh :exports both :eval no-export :wrap src json :results raw
         aws redshift describe-events --region eu-west-1
         aws redshift describe-events --region us-east-1
         aws redshift describe-events --region us-west-2
         #+end_src
***** TODO Review email notifications. Update or create Work Items, raise awareness if necessary.
      SCHEDULED: `daily-oncall-checklist-scheduled-time`
****** cron errors
****** AWS reports
****** GitHub Security Alert Digests (gmail filter =from:notifications@github.com subject:"security vulnerability"=)
